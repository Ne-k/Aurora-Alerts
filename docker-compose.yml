services:
  noaa_alert:
    build: .
    volumes:
      - .:/app
    entrypoint: ["bash", "-c"]
    environment:
      - DISCORD_WEBHOOK=${DISCORD_WEBHOOK}
      - KP_THRESHOLD=${KP_THRESHOLD:-6.5}
    command: >
      echo '0 8 * * * root cd /app && python "noaa alert.py" >> /var/log/cron.log 2>&1' > /etc/cron.d/noaa_alert &&
      chmod 0644 /etc/cron.d/noaa_alert &&
      crontab /etc/cron.d/noaa_alert &&
      touch /var/log/cron.log &&
      cron && tail -f /var/log/cron.log
    restart: always
  