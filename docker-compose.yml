version: '3.8'

services:
  aurora_bot:
    build: .
    container_name: aurora-bot
    restart: unless-stopped
    env_file:
      - .env
    environment:
      DISCORD_WEBHOOK: "${DISCORD_WEBHOOK:-}"
      DISCORD_BOT_TOKEN: "${DISCORD_BOT_TOKEN:-}"
      DISCORD_CLIENT_ID: "${DISCORD_CLIENT_ID:-}"
      # Core bot defaults; override via .env for production tuning
      KP_THRESHOLD: "${KP_THRESHOLD:-6.5}"
      LATITUDE: "${LATITUDE:-45.5152}"
      LONGITUDE: "${LONGITUDE:--122.6784}"
      LOCATION_NAME: "${LOCATION_NAME:-Portland, OR}"
      TIMEZONE_NAME: "${TIMEZONE_NAME:-America/Los_Angeles}"
      UPDATE_INTERVAL_HOURS: "${UPDATE_INTERVAL_HOURS:-2}"
      ALERT_DELETE_AFTER_MINUTES: "${ALERT_DELETE_AFTER_MINUTES:-15}"
      # Optional external APIs
      GFZ_JSON_BASE_URL: "${GFZ_JSON_BASE_URL:-https://kp.gfz.de/app/json/}"
      OPENWEATHER_API_KEY: "${OPENWEATHER_API_KEY:-}"
      MAF_APP_USER_ID: "${MAF_APP_USER_ID:-}"
      TZ: "${TZ:-UTC}"
    volumes:
      - ./data:/app/data
    healthcheck:
      test: ["CMD", "python", "-c", "import socket,sys; sys.exit(0)"]
      interval: 5m
      timeout: 10s
      retries: 3
      start_period: 30s
